<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>##터치애드:맞춤분석결과##</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" href="css/touchad.css" />
  </head>
  <body>
    <a href="#" class="site-logo">TOUCH AD</a>

    <main class="scroll-container">
      <section id="intro" class="scroll-section">
        <div class="intro-container">
          <div class="intro__left-pane animate-lines">
            <span class="line">원장님!</span>
          </div>
          <div class="intro__right-pane animate-fade-up">
            비슷한 특성의 고객 5,000명에게 도달하기 위해,<br />
            필요한 <span class="highlight-copy">터치애드 예산은 30만 원</span> (30일 동안 집행 예상)입니다.<br />
            평균 <span class="highlight-copy">5% 수준의 고객 전환을 기대</span>할 수 있습니다.<br />
            동일 조건의 <span class="highlight-copy">네이버 키워드 광고 집행 비용은 약 500만 원</span>이 소요 됩니다.
          </div>
        </div>
        <div class="intro__video-wrapper">
          <video autoplay muted loop playsinline data-desktop-src="mov/movie.mp4" data-mobile-src="mov/movie_mobi.mp4"></video>
        </div>
      </section>

      <div id="parallax-area" class="parallax-wrapper">
        <section id="about" class="scroll-section">
          <div class="section-container">
            <div class="text-block animate-on-scroll">
              <span class="line">원장님! AI가 분석한 터치애드 데이터를 기반으로 우리 병원의 타겟을 확인해보세요.</span>
            </div>
            <div class="text-block animate-on-scroll">
              <span class="line"
                >터치애드는 결제와 이동 데이터를 모두 활용하는 국내 유일의 광고 플랫폼입니다.
                <span class="usp"
                  >하루 50만 건 이상의 카드 결제 데이터를 통해 지금 어디서, 누가, 무엇을 소비했는지를 실시간으로 분석하여 실제 타겟 고객에게 유효한
                  광고를 집행</span
                >합니다. 또한, 교통카드 태깅 기반의 생활 반경·이동 동선 분석도 함께 이루어짐으로 단순한 관심이 아닌,
                <span class="usp">실제 구매력을 가진 타겟을 식별하여 시간·장소·상황까지 고려한 정밀 타겟팅</span>이 가능합니다.</span
              >
            </div>
          </div>
          <div class="text-block animate-on-scroll"><a href="http://runcomm.co.kr" class="footer-link download">터치애드 상품설명서 다운로드</a></div>
        </section>
        <section id="map-section" class="scroll-section">
          <div class="parallax__background">
            <video class="parallax__image" autoplay muted loop playsinline>
              <source src="mov/usp.mp4" type="video/mp4" />
            </video>
          </div>

          <div class="mobile-video-background">
            <video autoplay muted loop playsinline>
              <source src="mov/usp_mobi.mp4" type="video/mp4" />
            </video>
          </div>
        </section>
        <section id="testimonials" class="scroll-section">
          <div class="section-container">
            <h2 class="section-title animate-on-scroll"><span class="line">다른 원장님들도 터치애드로 인사이트를 얻고 있습니다</span></h2>
            <div class="table-container animate-on-scroll" style="transition-delay: 0.5s">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>날짜</th>
                    <th>지역</th>
                    <th>전문과</th>
                    <th>관심소비항목</th>
                    <th>주요소비층</th>
                    <th>도달예산 <span class="data-small">(5000명기준)</span></th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-quote="터치애드로 마케팅 비용을 70% 절감했습니다">
                    <td>2025.06.24<span class="touch-hint">👆</span></td>
                    <td>오류동</td>
                    <td class="specialty-highlight">내과</td>
                    <td>건강식품전문점<br /><span class="data-small">(1,320건)</span></td>
                    <td>30대<br /><span class="data-small">(21%)</span></td>
                    <td>약28만원</td>
                  </tr>
                  <tr data-quote="정확한 타겟팅으로 환자 만족도가 높아졌어요">
                    <td>2025.06.23<span class="touch-hint">👆</span></td>
                    <td>서초동</td>
                    <td class="specialty-highlight">정형외과</td>
                    <td>피트니스센터<br /><span class="data-small">(2,540건)</span></td>
                    <td>20대<br /><span class="data-small">(33%)</span></td>
                    <td>약31만원</td>
                  </tr>
                  <tr data-quote="숨쉬기 힘든 날, 그걸 눈치채는 건 데이터가 먼저였어요">
                    <td>2025.06.12<span class="touch-hint">👆</span></td>
                    <td>잠원동</td>
                    <td class="specialty-highlight">이비인후과</td>
                    <td>약국<br /><span class="data-small">(1,110건)</span></td>
                    <td>10대이하<br /><span class="data-small">(38%)</span></td>
                    <td>약25만원</td>
                  </tr>
                  <tr data-quote="광고비 대비 효과가 기존보다 3배 좋아졌습니다">
                    <td>2025.06.21<span class="touch-hint">👆</span></td>
                    <td>합정동</td>
                    <td class="specialty-highlight">피부과</td>
                    <td>미용실/피부관리숍<br /><span class="data-small">(1,980건)</span></td>
                    <td>10~20대<br /><span class="data-small">(41%)</span></td>
                    <td>약29만원</td>
                  </tr>
                  <tr data-quote="데이터 기반 마케팅의 힘을 실감했습니다">
                    <td>2025.06.20<span class="touch-hint">👆</span></td>
                    <td>신촌동</td>
                    <td class="specialty-highlight">신경외과</td>
                    <td>건강식품전문점<br /><span class="data-small">(1,650건)</span></td>
                    <td>40대<br /><span class="data-small">(30%)</span></td>
                    <td>약27만원</td>
                  </tr>
                  <tr data-quote="진료에만 집중할 수 있게 되었어요">
                    <td>2025.06.29<span class="touch-hint">👆</span></td>
                    <td>계산동</td>
                    <td class="specialty-highlight">산부인과</td>
                    <td>여성용품점<br /><span class="data-small">(2,210건)</span></td>
                    <td>30대<br /><span class="data-small">(45%)</span></td>
                    <td>약32만원</td>
                  </tr>
                  <tr data-quote="환자들이 정말 관심있어서 오시더라고요">
                    <td>2025.06.18<span class="touch-hint">👆</span></td>
                    <td>부평구</td>
                    <td class="specialty-highlight">한의원</td>
                    <td>다이어트/체형관리센터<br /><span class="data-small">(1,430건)</span></td>
                    <td>50대<br /><span class="data-small">(28%)</span></td>
                    <td>약26만원</td>
                  </tr>
                  <tr data-quote="상담 신청이 2배로 늘었습니다">
                    <td>2025.06.17<span class="touch-hint">👆</span></td>
                    <td>일산동구</td>
                    <td class="specialty-highlight">정신건강의학과</td>
                    <td>문화·교육서비스<br /><span class="data-small">(970건)</span></td>
                    <td>30대<br /><span class="data-small">(36%)</span></td>
                    <td>약30만원</td>
                  </tr>
                </tbody>
              </table>
              <div class="quote-overlay-row"></div>
            </div>
          </div>
          <div class="sliding-banner-container">
            <div class="sliding-banner-wrapper">
              <div class="sliding-banner" style="background-color: #e9f5ff">
                <span>첫 번째 배너 (5초간 노출)</span>
              </div>
              <div class="sliding-banner" style="background-color: #fff3e0">
                <span>두 번째 배너 (5초간 노출)</span>
              </div>
              <div class="sliding-banner" style="background-color: #e9f5ff">
                <span>첫 번째 배너 (5초간 노출)</span>
              </div>
            </div>
            <div class="banner-indicator">
              <div class="indicator-dot"></div>
              <div class="indicator-dot"></div>
            </div>
          </div>
        </section>
      </div>
      <section id="cta" class="scroll-section">
        <div class="section-container">
          <div class="cta__text-wrapper">
            <div class="text-block cta__main-copy animate-on-scroll">
              진료에 집중하고, 경영은 데이터가 해결하도록 그래서 우리는 단기 성과가 아닌, 지속 가능한 마케팅 전략을 실행합니다.<br />
              <span class="highlight-copy">터치애드는 그 첫 번째 제안입니다.</span>
            </div>
            <button class="cta__button animate-on-scroll">내 병원 주변 잠재 고객 리포트 무료 신청</button>
            <div class="text-block cta__footer animate-on-scroll">
              <br />신용카드 + 교통카드 데이터 활용 광고 경쟁 대비 낮은 예산, 높은 타겟 정확도<br />
              <span class="cta__main-copy animate-on-scroll">한국글로벌헬스케어협동조합 X 런커뮤니케이션</span>
            </div>
          </div>
        </div>
      </section>
      <footer class="site-footer">
        <div class="footer-container">
          <div class="footer-info-wrapper">
            <div class="footer-info--left">
              <span class="footer-info--co">한국글로벌헬스케어사업협동조합</span>
              서울 서초구 강남대로 331, 광일빌딩 20층 02 554 2929 | kogha@polestarhc.com
              <a href="http://www.kogha.or.kr/" class="footer-link">http://www.kogha.or.kr</a>
            </div>
            <div class="footer-info--right">
              <span class="footer-info--co">(주)런커뮤니케이션즈</span>
              서울시 성동구 뚝섬로1길 25 서울숲 한라에코밸리 903호 070 4442 3344 | srkim@runcomm.co.kr
              <a href="http://runcomm.co.kr" class="footer-link">http://runcomm.co.kr</a>
            </div>
          </div>
          <div class="footer-copyright">ⓒ 2025 KOREAN GLOBAL HEALTHCARE BUSINESS ASSOCIATION. All Right Reserved.</div>
        </div>
      </footer>
    </main>

    <div class="scroll-indicator">
      <div class="scroll-dot active" data-section="intro"></div>
      <div class="scroll-dot" data-section="about"></div>
      <div class="scroll-dot" data-section="testimonials"></div>
      <div class="scroll-dot" data-section="cta"></div>
    </div>

    <div id="mouse-follower"></div>

   <!-- CTA 버튼 (기존) -->
    <a href="#" class="floating-cta">
      <span class="floating-cta__icon">+</span>
      <span class="floating-cta__text">잠재 고객 리포트 무료 신청</span>
    </a>

  <!-- 모달 (처음에는 숨김 상태) -->
  <div id="ctaModal" class="modal">
    <div class="modal__content">
      <span class="modal__close">&times;</span>
      <h2>추가 입력폼</h2>
      <p>문의 요청이 접수되었습니다. 필요한 내용을 추가 입력해 주세요.</p>
      <!-- 추후 입력폼 넣을 자리 -->
    </div>
  </div>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        // --- 1. 변수 선언 ---
        const mainContainer = document.querySelector(".scroll-container");
        const sections = document.querySelectorAll(".scroll-section");
        const dots = document.querySelectorAll(".scroll-dot");
        const parallaxImage = document.querySelector(".parallax__image");
        const tableRows = document.querySelectorAll(".data-table tbody tr");
        const logo = document.querySelector(".site-logo");
        const floatingButton = document.querySelector(".floating-cta");
        const footer = document.querySelector(".site-footer");
        const { hospitalName, generalData, resData } = JSON.parse(localStorage.getItem("touchadData"));
        const introLeft = document.querySelector(".intro__left-pane");
        // 비율 계산
        const agePercent = Math.round((resData[1].target / resData[0].target) * 100, 1);
        const genderPercent = Math.round((resData[2].target / resData[0].target) * 100, 1);

        const span = document.createElement("span");
        span.className = "line";
        span.innerHTML = `지난 4주간, ${hospitalName} <span class="uspH">반경 700m</span> 내에서 <span class="uspH">${resData[0].target.toLocaleString()}</span>건의 <span class="uspH">${
          generalData.partnerCd
        } 관련 소비</span>가 있었습니다. 이 중 <span class="uspH">${generalData.age}는 ${isNaN(agePercent) ? 0 : agePercent}%, ${
          generalData.gender
        }은 ${isNaN(genderPercent) ? 0 : genderPercent}%</span>입니다.`;
        introLeft.appendChild(span);

        // isMobile 변수를 스크립트 상단에서 한 번만 선언하여 모든 기능이 공유하도록 합니다.
        const isMobile = window.innerWidth <= 768;

        // PC 전용 변수
        const mouseFollower = document.getElementById("mouse-follower");
        let mouseX = 0,
          mouseY = 0,
          followerX = 0,
          followerY = 0;
        const speed = 0.15;

        // 패럴랙스 관련 변수
        let heightDifference = 0,
          zoneStarts = 0,
          zoneEnds = 0,
          zoneHeight = 0;

        // --- 2. 함수 정의 ---

        function calculateParallaxValues() {
          const mapSection = document.getElementById("map-section");
          const testimonialsSection = document.getElementById("testimonials");
          if (isMobile || !parallaxImage || !mapSection || !testimonialsSection) return;
          heightDifference = parallaxImage.offsetHeight - mapSection.offsetHeight;
          zoneStarts = mapSection.offsetTop;
          zoneEnds = testimonialsSection.offsetTop + testimonialsSection.offsetHeight;
          zoneHeight = zoneEnds - zoneStarts;
        }

        function handleScroll() {
          const scrollTop = mainContainer.scrollTop;
          const viewportHeight = window.innerHeight;

          // 패럴랙스 스크롤 (PC에서만 작동)
          if (!isMobile && zoneHeight > 0 && scrollTop >= zoneStarts - viewportHeight && scrollTop <= zoneEnds) {
            const scrollInZone = scrollTop - zoneStarts + viewportHeight;
            const progress = scrollInZone / (zoneHeight + viewportHeight);
            const clampedProgress = Math.max(0, Math.min(1, progress));
            if (heightDifference > 0) {
              parallaxImage.style.transform = `translateY(${clampedProgress * -heightDifference}px)`;
            }
          }

          // 인디케이터 활성화 로직 (PC에서만 작동)
          if (!isMobile) {
            const scrollMidpoint = mainContainer.clientHeight / 2;
            let currentSectionId = "intro";
            let minDiff = Infinity;
            sections.forEach((section) => {
              const rect = section.getBoundingClientRect();
              const diff = Math.abs(rect.top + rect.height / 2 - scrollMidpoint);
              if (diff < minDiff) {
                minDiff = diff;
                currentSectionId = section.id;
              }
            });
            dots.forEach((dot) => dot.classList.toggle("active", dot.dataset.section === currentSectionId));
          }

          // 배경색 전환
          const introSection = document.querySelector("#intro");
          const introBottom = (introSection?.offsetTop || 0) + (introSection?.offsetHeight || 0);
          if (scrollTop >= introBottom - viewportHeight * 0.4) {
            mainContainer.style.backgroundColor = "white";
            mainContainer.style.color = "#222";
          } else {
            mainContainer.style.backgroundColor = "black";
            mainContainer.style.color = "white";
          }
        }

        function animateFollower() {
          if (isMobile) return; // 모바일에서는 함수 실행 즉시 중단
          const distX = mouseX - followerX;
          const distY = mouseY - followerY;
          followerX += distX * speed;
          followerY += distY * speed;
          if (mouseFollower) {
            mouseFollower.style.transform = `translate3d(${followerX}px, ${followerY}px, 0)`;
          }
          requestAnimationFrame(animateFollower);
        }

        // --- 3. 이벤트 리스너 및 기능 초기화 ---

        // 로고 클릭 이벤트
        if (logo) {
          logo.addEventListener("click", (e) => {
            e.preventDefault();
            mainContainer.scrollTo({ top: 0, behavior: "smooth" });
          });
        }

        mainContainer.addEventListener("scroll", handleScroll);
        document.querySelector(".cta__button")?.addEventListener("click", () => {
          alert("상담 신청이 접수되었습니다!");
        });

        // 테이블 인터렉션 (PC/모바일 분기 처리)
        if (isMobile) {
          // 모바일: 각 행 위에 순차적으로 롤링 멘트 표시
          const quoteOverlay = document.querySelector(".quote-overlay-row");
          if (tableRows.length > 0 && quoteOverlay) {
            let currentIndex = 0;
            const quoteDuration = 3000; // 멘트가 보이는 시간 (3초)
            const intervalTime = 4000; // 다음 멘트까지의 간격 (4초)

            setInterval(() => {
              const currentRow = tableRows[currentIndex];
              const nextIndex = (currentIndex + 1) % tableRows.length;
              const nextRow = tableRows[nextIndex];

              quoteOverlay.textContent = `"${currentRow.getAttribute("data-quote")}"`;
              quoteOverlay.style.top = `${currentRow.offsetTop}px`;
              quoteOverlay.style.height = `${currentRow.offsetHeight}px`;
              quoteOverlay.style.width = `${currentRow.offsetWidth}px`;
              quoteOverlay.classList.add("visible");

              setTimeout(() => {
                quoteOverlay.style.top = `${nextRow.offsetTop}px`;
              }, quoteDuration - 600);

              setTimeout(() => {
                quoteOverlay.classList.remove("visible");
              }, quoteDuration);

              currentIndex = nextIndex;
            }, intervalTime);
          }
        } else {
          // PC: 기존 마우스오버 말풍선 기능
          const tableContainer = document.querySelector(".table-container");
          const quoteOverlay = document.querySelector(".quote-overlay-row");
          if (tableContainer && quoteOverlay) {
            const tbody = tableContainer.querySelector("tbody");
            tbody?.addEventListener("mouseenter", () => {
              quoteOverlay.style.opacity = "1";
            });
            tbody?.addEventListener("mouseleave", () => {
              quoteOverlay.style.opacity = "0";
            });
            tableRows.forEach((row) => {
              row.addEventListener("mouseenter", () => {
                quoteOverlay.textContent = `"${row.getAttribute("data-quote")}"`;
                quoteOverlay.style.top = `${row.offsetTop}px`;
                quoteOverlay.style.height = `${row.offsetHeight}px`;
                quoteOverlay.style.width = `${row.offsetWidth}px`;
              });
            });
          }
        }

        // 스크롤 요소 애니메이션
        const animationObserver = new IntersectionObserver(
          (entries, observer) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("is-visible");
                observer.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.1 }
        );
        document.querySelectorAll(".animate-on-scroll").forEach((el) => animationObserver.observe(el));

        // --- 비디오 로딩 (반응형 소스 교체) ---
        function loadResponsiveVideo() {
          const video = document.querySelector(".intro__video-wrapper video");
          if (!video) return;

          const isNowMobile = window.innerWidth <= 768;
          const newSrc = isNowMobile ? video.dataset.mobileSrc : video.dataset.desktopSrc;
          const currentSrcElement = video.querySelector("source");
          const currentSrc = currentSrcElement ? currentSrcElement.getAttribute("src") : "";

          // 현재 재생 중인 소스와 바꿔야 할 소스가 다를 경우에만 교체합니다.
          if (newSrc && newSrc !== currentSrc) {
            video.innerHTML = ""; // 기존 소스 태그 제거
            const sourceElement = document.createElement("source");
            sourceElement.setAttribute("src", newSrc);
            sourceElement.setAttribute("type", "video/mp4");
            video.appendChild(sourceElement);
            video.load(); // 새로운 소스로 비디오를 다시 로드
          }
        }

        // 1. 페이지가 처음 로드될 때 한 번 실행
        loadResponsiveVideo();

        // 2. 브라우저 창 크기가 변경될 때마다 다시 실행
        window.addEventListener("resize", loadResponsiveVideo);

        // 3. 비디오가 나타나는 애니메이션 효과는 그대로 유지합니다.
        const videoWrapper = document.querySelector(".intro__video-wrapper");
        if (videoWrapper) {
          const triggerElement = document.querySelector(".animate-lines .line:nth-child(3)");
          triggerElement?.addEventListener(
            "animationend",
            () => {
              videoWrapper.classList.add("visible");
            },
            { once: true }
          );
        }

        // PC 전용 기능 초기화
        if (!isMobile) {
          // 패럴랙스
          if (parallaxImage) {
            parallaxImage.onload = calculateParallaxValues;
            window.addEventListener("resize", calculateParallaxValues);
            if (parallaxImage.complete) calculateParallaxValues();
          }
          // 마우스 팔로워
          window.addEventListener("mousemove", (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
          });
          animateFollower();
        }

        // 플로팅 버튼 & 푸터 충돌 감지
        if (floatingButton) {
          if (isMobile) {
            let collapseTimer;
            floatingButton.addEventListener("click", (e) => {
              e.preventDefault();
              floatingButton.classList.add("expanded");
              clearTimeout(collapseTimer);
              collapseTimer = setTimeout(() => {
                floatingButton.classList.remove("expanded");
              }, 3000);
            });
          } else {
            floatingButton.addEventListener("mouseenter", () => {
              floatingButton.classList.add("expanded");
            });
            floatingButton.addEventListener("mouseleave", () => {
              floatingButton.classList.remove("expanded");
            });
          }

          if (footer) {
            const footerObserver = new IntersectionObserver(
              (entries) => {
                entries.forEach((entry) => {
                  if (entry.isIntersecting) {
                    const footerHeight = footer.offsetHeight;
                    floatingButton.style.position = "absolute";
                    floatingButton.style.bottom = `${footerHeight + 20}px`;
                  } else {
                    floatingButton.style.position = "fixed";
                    floatingButton.style.bottom = "40px";
                  }
                });
              },
              { threshold: 0 }
            );
            footerObserver.observe(footer);
          }
        }
      });

//0923
// CTA 버튼 클릭 시 Google Sheet에 request=Y 업데이트
function attachCTAEvent(selector) {
  const elements = document.querySelectorAll(selector);
  elements.forEach(el => {
    el.addEventListener("click", async (e) => {
      e.preventDefault();

      const uuid = localStorage.getItem("user_uuid");
      if (!uuid) {
        alert("사용자 정보가 없습니다. 처음부터 다시 진행해주세요.");
        return;
      }

      try {
        const response = await fetch("/api/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ uuid: uuid, request: "Y" }),
        });

        const result = await response.json();
        console.log("서버 응답:", result);

        if (result.result === "updated") {
          // ✅ 업데이트 성공 → 모달 열기
          document.getElementById("ctaModal").style.display = "flex";
        } else {
          alert("문의 요청 처리에 문제가 발생했습니다.");
        }
      } catch (err) {
        console.error("API 호출 오류:", err);
        alert("서버 연결에 실패했습니다.");
      }
    });
  });
}

// 닫기 버튼 이벤트
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("ctaModal");
  const closeBtn = document.querySelector(".modal__close");

  closeBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });

  // 바깥 영역 클릭 시 닫기
  window.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });
});

// 두 종류 CTA 모두 이벤트 연결
attachCTAEvent(".floating-cta");
attachCTAEvent(".cta__button");
    </script>
  </body>
</html>
